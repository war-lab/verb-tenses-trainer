# アーキテクチャ設計書 (Verb Tenses Trainer)

## 1. 概要
本プロジェクトは React + TypeScript + Vite で構築されたシングルページアプリケーション（SPA）です。
「時制（Tense: 過去/現在/未来）」と「相（Aspect: 完了/進行）」を独立して操作し、英語の動詞表現のニュアンス変化を体感的に学習することを目的としています。

## 2. コア設計指針
### 2.1 ロジックとUIの分離
- **活用ロジック** (`conjugator.ts`) は、UIコンポーネントから完全に分離されています。
- `SentenceTemplate`（文の雛形）と、状態（時制、相、未来モード）を入力として受け取り、`ConjugatedResult`（トークン列 + 警告情報）を返します。
- これにより、ロジック単体でのテストが容易になり、将来的なプラットフォーム拡張にも対応しやすくなっています。

### 2.2 データ駆動アプローチ
- **データベース不要**: すべてのコンテンツは静的な TypeScript ファイル (`verbs.ts`, `sentences.ts`) として管理されています。
- **テンプレート方式**: 例文は、動詞・主語・目的語などを「穴埋め」可能なテンプレートとして定義されており、文法ルールに基づいてエンジンが動的に文を再構築します。

### 2.3 トークンベースのレンダリング
- 生成エンジンは単純な文字列ではなく、「トークン」の配列 (`{ text: string, kind: 'aux'|'verb'|... }`) を返します。
- これにより、UI上での**きめ細やかなハイライト表示**（助動詞を赤系、本動詞を青系にする等）を実現し、学習者が文構造の変化を瞬時に視覚的に理解できるよう設計されています。

## 3. ディレクトリ構成
```
src/
├── components/
│   ├── ui/          # 再利用可能なUIコンポーネント (Card, Badge, SectionHeader)
│   ├── Header.tsx   # グローバルヘッダー（ダークモード切替、ナビゲーション）
│   ├── SentencePicker.tsx
│   ├── TenseControls.tsx
│   ├── GeneratedSentence.tsx
│   ├── NuanceNote.tsx
│   └── StateSummary.tsx
├── data/            # 静的データ（動詞辞書、例文テンプレート）
├── domain/          # 型定義 (Types)
├── lib/
│   ├── conjugator.ts # コアロジック（活用エンジン）
│   └── cn.ts         # Tailwindユーティリティ (clsx + tailwind-merge)
├── pages/           # ページコンポーネント (Trainer, Compare, Guide)
└── App.tsx          # ルーティング設定とレイアウト
```

### 3.1 UIコンポーネントシステム
- **Tailwind CSS**: デザインシステムの基盤として採用。全てのスタイリングはTailwindのユーティリティクラスで実装。
- **コンポーネントキット** (`src/components/ui/`):
  - `Card`: 統一されたカードレイアウト（`rounded-2xl`, `shadow-sm`, 固定パディング）
  - `Badge`: 3種類のバリアント（default, muted, outline）
  - `SectionHeader`: タイトル、説明文、アイコンを含むセクションヘッダー
- **cn()ユーティリティ**: `clsx`と`tailwind-merge`を組み合わせ、条件付きクラス名とTailwindクラスの競合解決を実現。

## 4. 重要な決定事項とトレードオフ
- **ニュアンスの単純化**: 厳密には「過去完了」などは時制と相の組み合わせですが、MVP（Minimum Viable Product）では、学習者に分かりやすく提示するため、主にアスペクト（相）に基づくニュアンス（例：「完了形 ＝ 完了/結果」）を優先してマッピングしています。
- **未来表現の扱い**: 未来（Future）は時制の一つとして扱いつつ、英語特有の多様な表現（will / be going to / 進行形など）をカバーするため、「Future Mode」という概念を導入しています。
- **警告（Warning）システム**: 「状態動詞の進行形」など、文法的に不自然な組み合わせを選択させないのではなく、「生成した上で警告を表示する」方針を採用しました。これにより、「なぜそれが不自然なのか」を学習者が理解できる教育的効果を狙っています。

## 5. レスポンシブデザイン
- **デスクトップ**: 2カラムレイアウト（左: 入力コントロール、右: 出力結果 + Sticky配置）
- **モバイル**: 縦スタックレイアウト + ハンバーガーメニュー
- **ダークモード**: システム全体でライト/ダークテーマ切り替えに対応。`dark:`クラスを使用した完全なカラーパレット対応。

## 6. 今後の改善案
- **動詞の追加**: `verbs.ts` に追記するだけで容易に語彙を拡張可能です。
- **カスタム例文**: ユーザーが自分で動詞を入力して試せるモードの実装などが考えられます。
- **アニメーション強化**: トークンハイライトやページ遷移時のスムーズなアニメーション追加。
